/* Hulk v0.1 | (c) 2013 Kevin Burke | License: MIT */
!function(a){var b="=>",c=function(){var a=document.createElement("button");return a.setAttribute("class","hulk-save"),a.innerHTML="Save",a},d=function(b,c){a(b).on("click",c)},e=function(b){a(b).on("click",function(c){c.preventDefault();var d=a(b).next();a(b).hasClass("collapsed")?(a(b).text("Collapse"),a(d).slideDown("slow",function(){a(b).removeClass("collapsed")})):a(d).slideUp("slow",function(){a(b).addClass("collapsed"),a(b).text("Expand")})})},f=function(b,c){a(b).on("click",function(d){d.preventDefault();var e=o("",c);a(b).before(e)})},g=function(b,c){a(b).on("click",function(d){d.preventDefault();var e=o({"":""},c);a(b).before(e)})},h=function(b,c){a(b).on("click",function(d){d.preventDefault();var e=m("","",c);a(b).before(e)})},i=function(a,b,c){return"undefined"==typeof a?c:"undefined"==typeof a[b]?c:a[b]},j=function(a){return!isNaN(parseFloat(a))&&isFinite(a)},k=function(a){return"object"==typeof a&&!(a instanceof Array)},l=function(a){try{return a.filter(k).length===a.length}catch(b){return!1}},m=function(c,d,f){var g=i(f,"separator",b),h=i(f,"depth",-1),j=a(document.createElement("div"));j.addClass("hulk-map-pair");var k=a(document.createElement("input"));k.addClass("hulk-map-key"),k.attr("value",c),j.append(k);var l=a(document.createElement("p"));l.addClass("hulk-separator"),l.text(g),j.append(l);var m=jQuery.extend(!0,{},f);h>0&&(m.depth=h-1);var n=s(d,m,c);if(n.addClass("hulk-map-value-container"),n.children(".hulk-map-pair, .hulk-array-element").length>0){var o=a(document.createElement("button"));o.addClass("hulk-collapse-item"),0!==h?(o.text("Collapse"),e(o),j.append(o)):(o.addClass("collapsed"),o.text("Expand"),n.hide(),e(o),j.append(o))}return j.append(n),j},n=function(b,c,d){var e=a(document.createElement("div"));e.addClass("hulk-map");var f,g=[];for(f in b)b.hasOwnProperty(f)&&g.push(f);g.sort();for(var i=0;i<g.length;i++){f=g[i];var j=b[f],k=m(f,j,c);e.append(k)}var l=a(document.createElement("button"));l.addClass("hulk-map-add-pair");var n=p("key/value pair",d);return l.text(n),h(l,c),e.append(l),e},o=function(b,c){var d=a(document.createElement("div"));return d.addClass("hulk-array-element"),d.html(s(b,c)),d},p=function(a,b){var c=typeof b,d=30;return"undefined"===c||"string"!==c?["Add new ",a].join(""):b.length>d?["Add new ",a," to ",b.substring(0,d),"..."].join(""):["Add new ",a," to ",b].join("")},q=function(b,c,d){var e=a(document.createElement("div"));e.addClass("hulk-array");for(var h=0;h<b.length;h++){var i=o(b[h],c);e.append(i)}var j;if(l(b)){var k=a(document.createElement("button"));k.addClass("hulk-array-add-pair"),j=p("object",d),k.text(j),g(k,c),e.append(k)}else{var m=a(document.createElement("button"));m.addClass("hulk-array-add-row"),j=p("element",d),m.text(j),f(m,c),e.append(m)}return e},r=function(b,c){var d,e=80;return"string"===c&&b.length>e?(d=a(document.createElement("textarea")),d.attr("rows",7),d.attr("cols",80),d.addClass("hulk-input-textarea")):(d=a(document.createElement("input")),d.addClass("hulk-input-text")),d.addClass("hulk-map-value"),d.val(b),d},s=function(a,b,c){var d=typeof a;return"string"===d||"number"===d||"boolean"===d||null===a?r(a,d):"[object Array]"===Object.prototype.toString.call(a)?q(a,b,c):n(a,b,c)},t=function(a,b){if(j(a))return parseFloat(a);if("true"===a)return!0;if("false"===a)return!1;if(null===a||"null"===a)return null;if(0===a.length){var c=i(b,"emptyString",!1);return c===!0?"":null}return a},u=function(b,c){var d=b.children(".hulk-map");if(d.length>0)return u(d,c);var e=b.children(".hulk-map-pair");if(e.length>0){var f={};return e.each(function(b,d){var e=a(d),g=e.children(".hulk-map-key");""!==g.val()&&(f[g.val()]=u(e.children(".hulk-map-value-container"),c))}),f}var g=b.children(".hulk-array");if(g.length>0)return u(g,c);if(b.hasClass("hulk-array")){var h=[];return b.children(".hulk-array-element").each(function(b,d){h.push(u(a(d),c))}),h}if(b.hasClass("hulk-map-value")){var j=i(c,"smartParsing",!0);return j?t(b.val(),c):b.val()}var k=b.children(".hulk-map-value");return k.length?u(k,c):b.hasClass("hulk-map-value-container")?u(b.children(".hulk-map-value"),c):{}};a.hulk=function(b,e,f,g){var h=a(b);if(h.addClass("hulk"),0===h.length)return console.error("Attempting to hulk-ify element with selector "+b+" failed because the element does not exist. "+"Quitting"),void 0;var i=s(e,g),j=c();return d(j,function(){var a=u(h.children(),g);f(a)}),h.html(i),h.append(j),h},a.hulkSmash=function(b,c){return u(a(b),c)}}(jQuery);